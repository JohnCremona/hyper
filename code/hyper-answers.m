
// hyper-answers.m
// Some formulae related to the probability that a hyperelliptic 
// curve is everywhere locally soluble
// T. Fisher, August 2016

/////////////////////////////////////////////////////////////////
//
// This file records the values I computed for the following 
// quantities.
//
// rho1(p)
// rho2(p)
// alpha(i,eps,p)
// beta(i,eps,p)
//
/////////////////////////////////////////////////////////////////

unram := false;

function rho1(p)
  ans := (8*p^10 + 8*p^9 - 4*p^8 + 2*p^6 
    + p^5 - 2*p^4 + p^3 - p^2 - 8*p - 5)/(8*(p + 1)*(p^9 - 1));
  return ans;
end function;

function rho2(p)
  pp := [2,3,5,7,11];
  i := p in pp select Position(pp,p) else 0;
  if i ne 0 then 
    ans := [521968414037549/557460453580800,
        //   7485449003329669/7990266501324800,
    11908283690073923675989/12265526054691898243200,
    21168046192107392417824270157/21315998310595527294273375000,
    9225394906523129800081108647433021/9243647281033059837025942476710400,
    291968807821387146869087552918410773299321/292073047488128339469598819346962539694720][i];
  else
    ans := (p-1)^3*(144*p^40 + 576*p^39 + 1296*p^38 + 2232*p^37 +
    3384*p^36 + 4788*p^35 + 6492*p^34 + 8263*p^33 + 10041*p^32 +
    11580*p^31 + 12883*p^30 + 13947*p^29 + 14784*p^28 + 15378*p^27 +
    15785*p^26 + 15912*p^25 + 15965*p^24 + 16172*p^23 + 16296*p^22 +
    16337*p^21 + 16191*p^20 + 15715*p^19 + 15006*p^18 + 14095*p^17 +
    12964*p^16 + 11580*p^15 + 9739*p^14 + 7905*p^13 + 6228*p^12 +
    4662*p^11 + 3329*p^10 + 2139*p^9 + 1212*p^8 + 521*p^7 + 81*p^6 -
    36*p^5 - 90*p^4 - 144*p^3 
    - 144*p^2 - 144*p - 72)/(144*p^6*(p+1)*(p^20-1)*(p^9-1)*(p^7-1));
  end if;
  return ans;
end function;

function rho3(p)
  pp := [2,3,5,7,11,13,17,19];
  i := p in pp select Position(pp,p) else 0;
  if i eq 2 then return 
    341947650353077734424671144337255654488619491925373857/352129923021605466157817219233951832056896259545331200; 
  end if;
  if i eq 3 then return 
    86097630260784435447100598782562008926113896114013014530256922666498909279/86666803123976066755869260179323358963196506650206092672348022460937500000; 
  end if;
  if i eq 4 then return 305506442225959695750731221696357847002652799121681101310512708797306578845450637/305990864147524980302408365049149826079047472404966616252928609903674358381056000; 
  end if;
  if i eq 5 then return 180381571841180908637993538515031270909180246518441013584176907296658488528568533984567035173827692691/180400743281165829494219178794411859093803084918009201007525439211677254684714957353538885664070745600;
  end if;
if i eq 6 then return 56436513939340864051763567947767739265217884838160058023121276435745647756489025435740351887740315083551/56438369264054703660878373727149871197122495421013146340682554818431287327790812757797626586573714226400;
  end if;
if i eq 7 then return 19576400522426429088568588738058180397597986892680480588688953801551407094217802927516631345885114921887863106374891/19576524741352669758651197387522637257387105112162448594248715236280289913300659213066392916414975836300436672613600; 
  end if;
if i eq 8 then return 397080281898692114315140080468919438743491351972325483159482395965279526502566996354913055476049191986968190953590827681/397081783878981691068459885208595813525996542578822208487535509368851516269249962017698346568130230329932384249699520000;
  end if;
  return 0;
end function;

function rho4(p)
  assert p in [3,5];
  if p eq 3 then 
  return 15854460792974503602330982116609970821445897720580933554536013371343633534106464013726664256174843/16326549944436990286916848331790201456737361337349232493288949452111255538564144731309314454517760;
  end if;
  return 1852347137600928118715442323595369815175424790491781831875509743399588509337901\
26330390340451977716386769436352807003356748262659106059244599/1864582264374242\
0918440421228644257497127592583034436250891001226332618976279363751540659914756\
4647989128161498229019343852996826171875000000;
end function;

function rho5(p)
  assert p eq 3;
  return 151945062515662969772674862121041669903750824592222454729757209442586497959909158791850012003604198730776790066879532307608449714862817580005909509931811001278539015404035994971560334027/156469443058414710046148987965895981096445906773520877784330159546831035838446549411828124119623598495958443849366452592968644150627747140288566661529681079275249631006158068920238080000;
  end function;

// The quantities alpha_i^eps (where eps = 0, +1, -1) are defined
// in the paper. 

function alpha(i,eps,p) 
  assert eps in [0,1,-1]; 
  if unram and eps in [-1,1] then return
 [
    1,
    1/p,
    (p^7 - p + 1)/p^8,
    (p^5 - p + 1)/p^6,
    (p^25 - p^21 + p^20 - p^10 + p^9 - p^3 + 2*p - 1)/p^26,
    (p^24 + p^23 + p^22 + p^21 + p^19 + p^18 + p^17 + p^16 - 2*p^10 + 2*p^9 + 
        p^2 + p - 1)/(p^25 + p^24 + p^23 + p^22 + p^21 + p^20 + p^19 + p^18 + 
        p^17)
][i]; end if;
  if unram and eps eq 0 then return [
    1,
    1,
    (p^3 - p + 1)/p^3,
    (p^8 + p^7 + p^5 + p^4 + p^3 + p^2 + p + 1)/(p^8 + p^7 + p^6 + p^5 + p^4 + 
        p^3 + p^2 + p + 1),
    (p^12 - p^10 + p^9 - p^3 + 2*p - 1)/p^12,
    (p^25 + p^24 + p^22 + p^21 + p^20 + p^19 + p^18 + p^17 + 2*p^14 + p^13 + 
        p^12 + p^11 + p^10 + p^9 + p^8 + p^7 + p^6 - p^2 + 2*p - 1)/(p^25 + p^24
        + p^23 + p^22 + p^21 + p^20 + p^19 + p^18 + p^17 + p^16 + p^15 + p^14 + 
        p^13 + p^12 + p^11 + p^10 + p^9 + p^8 + p^7 + p^6)
][i];
  end if;
  if eps eq 1 then 
    ans := [ 1, 1/p, (p^7 - 1/2*p^6 + 1/6*p^5 - 1/6*p^3 + 1/2*p^2 - p
  + 1)/p^8, (p^5 - 1/2*p^4 + 1/2*p^2 - p + 1)/p^6, (p^26 + 1/2*p^25 -
  1/2*p^24 + 1/2*p^23 - 1/2*p^22 + p^20 - 1/2*p^19 - 11/30*p^17 +
  2/15*p^16 - 1/12*p^15 + 1/6*p^14 - 3/10*p^13 + 1/5*p^12 + 1/4*p^11 -
  1/3*p^7 + 1/6*p^5 - 5/6*p^3 + 3/2*p^2 + p - 1)/(p^27 + p^26), (p^24
  + 1/2*p^23 + 1/2*p^22 + p^21 + p^19 + p^18 + 1/2*p^17 + p^16 -
  7/8*p^15 + 2/3*p^14 - 1/2*p^13 + 5/24*p^12 + 1/2*p^11 - 3/2*p^10 +
  3/2*p^9 + 1/2*p^8 + 1/2*p^6 + 1/3*p^5 + 1/2*p^4 + 1/6*p^3 + 1/2*p^2
  + p - 1)/(p^25 + p^24 + p^23 + p^22 + p^21 + p^20 + p^19 + p^18 +
  p^17),0,0,0,0,0,0 ][i];
    ans2 := [ 1, 1/2, 807/2048, 407079/1048576, 
      2622066552451585/6755399441055744, 
      1404959750285651485151231/3619693909119583056297984 ];
    ans3 := [ 1, 1/3, 50246/177147, 16600/59049, 
      13670659773280445407/48630661836227715204, 
      605398279518845051650813/2153584544086426253951538,
      187753337253607305545121505175940613398920570773363/667895332546333959997341758422844963906033267359584, 
      16629970212462917568198863073211173479540678339463245443/59157827220326411850555181749157761107710203284825145600,0,0,0,0 ];
    ans3 := [ 1, 1/3, 50246/177147, 16600/59049, 
13670659773280445407/48630661836227715204, 
605398279518845051650813/2153584544086426253951538, 
187753337253607305545121505175940613398920570773363/667895332546333959\
997341758422844963906033267359584, 16629970212462917568198863073211173\
479540678339463245443/591578272203264118505551817491577611077102032848\
25145600, 293015822835772245417206734021230541922558541973918428346703\
1342800635088255704745791910288914125089/10423457888787869940107305436\
2877895319315988585583313677327018569154113649994298650905150713812062\
72, 830075263416735652179306710086776665620440931856255536070648976706\
30413552337465043374819213534662013310304803/2952828440803419089762084\
0778777909269270496316473864852014963226020121772512364861829526943373\
2227041399406720, 5970379541594892069792908802063196645181495868768077\
8518664777205483156476193605741544738341396485028957180719155230670781\
9205300831091001934399861894787415751526101305571160428763677151/21238\
4434156562265741925898072218175340844445265735991943915204023996507795\
7989960515853351702398526111975120076891345477382943039365593362169428\
646273985440832338990333464819033318963200, 
1322043530818637931859505496713702125123720130956951829370379814901531\
0416898840093021045812567497058508603996546004173758519581071678994916\
927627275407323916748522963237518383435047796304491/470290816969156696\
1173118302349075423191997233420070244756511841325861041755514686900939\
0023279641949047571329555711725051044493241982721202881158775692394019\
888695969524862933419843855513600 ];
ans5 := [ 1, 1/5, 70821/390625, 352624/1953125, 7881735107302540780681213/4365574568510\
0555419921875, 9852163823321934578756287/54569654166698455810546875, 
4594295664915181847515964291299799399275450088590309341204889987517/25447112945\
942849427538199821863251770537317497655749320983886718750, 
801130306569576433894857580214995208158121842602338319232011230530441/443734031\
9948737840041340287772220207784812373574823141098022460937500, 
1481204012907334609063976830226938921994844152104222812172709816005597277129099\
332950907640864578198958026311016300946861429570798278111511276737/820416633180\
1067534627073651394325160676867110627398340432917526150065662591691810798530884\
648087845804204087940547651669476181268692016601562500, 
5563413666356971155756672477964101359198450242369000240178442700806099708989469\
76868800620668816652131194872993836066759758315242140920455664751885123/3081491\
1851216592745194159793434390236618395052169984062536614554679422851289513600160\
64212260758632103054693862631552292441483587026596069335937500000 ];
    ans7 := [ 1, 1/7, 767481/5764801, 15625/117649, 
      1710545717378249174221103/12879623023252718907350428, 
      182610285494030123515924870813/1374971515631928722793570569956,
      830114274541297592293080584331836820071841798491148872924651/6250378937450715596714432387525627307158694840247124663622096, 
      5569452189327777833141039680607931195094819998134297847492720671711402816993/41935415068665086604345748911914103464043614886577501019022877000553112832000 ];
    ans11 := [ 1, 1/11, 18628061/214358881,153781/1771561,
      75109175359823491550762525047/865259616638995404226056384486,
      55080061907050138768714246031/634523718599496631792750678276,
      6032775888520367004764399023485838243810841499507464827343460110034176693/69497732168876828426485829264835634867483437575969293146574345694846395592, 
      47779585037081306677663011920057544262936119252866457626949199774518778921/550422038777504481136949600489614886470912717816299359475624987321864645888 ];
 ans13 := [ 1, 1/13, 60396701/815730721, 357085/4826809, 
47504712059849703293135923857/642133311352880316608797312063, 
276105429591509172968714307755/3732187526214929389326354758018, 
117976031715216926293876523001622837085299903516776925875056702730351488881807/\
1594712116350970658045057160234673882531272000213533003327166270941707944109694\
, 89465157384039502439518321955867662498812524995973928250515023928194216769044\
7/12093233548994860823507713812042711923868667990703324256525706265938941618784\
600 ];
ans17 := [ 1, 1/17, 398505841/6975757441, 1378225/24137569, 
50412827913925023541391741610049/882905994089305563977754208631721, 
350089082732619524643294327055/6131291625568475011255397067737, 
1504096757971831367306280889386471201341139300883517247241543616821649511538786\
2695/26342026390010929326008092597151831352693462132679469614007922597248565774\
2378102337, 4230272131795775720548913960411001990907481229664132374988116072458\
563540467806777/740869492219057387293977422004710941189302862003952337343581341\
97845619933856136650 ];
ans19 := [ 1, 1/19, 870760501/16983563041, 2411101/47045881, 
906332225439034179346353736275661/17684534180768657011955825953294810, 
2237857346756066919917409760585/43665516495589760847846859089964, 
1141520299231419575204911436927387779821750080211927454515310876878607253408149\
9095071/22273570533168293111706588668544927112466026228683768724201241122817206\
4878210461618040, 8399707867780865159712372380835853435772238948602182586983391\
4991983799011479540071/16389676624847897801108600497428052478186327266935842430\
11118292835328847230163360000 ];
//   if [i,p] eq [6,13] then 
//      ans := 276105429591509172968714307755/3732187526214929389326354758018; 
//    end if; 
  elif eps eq -1 then 
    ans := [ 1, 1/(p + 1), (p^7 - 1/2*p^6 + 1/6*p^5 - 1/6*p^3 +
    1/2*p^2 - p + 1)/p^8, (p^9 + 5/2*p^8 + 5/2*p^7 + 5/2*p^6 + 5/2*p^5
    + 2*p^4 + 3*p^3 + 3*p^2 + 2*p + 1/2)/(p^10 + 3*p^9 + 4*p^8 + 4*p^7
    + 4*p^6 + 4*p^5 + 4*p^4 + 4*p^3 + 4*p^2 + 3*p + 1), (p^26 +
    1/2*p^25 - 1/2*p^24 + 1/2*p^23 - 1/2*p^22 + p^20 - 1/2*p^19 -
    11/30*p^17 + 2/15*p^16 - 1/12*p^15 + 1/6*p^14 - 3/10*p^13 +
    1/5*p^12 + 1/4*p^11 - 1/3*p^7 + 1/6*p^5 - 5/6*p^3 + 3/2*p^2 + p -
    1)/(p^27 + p^26), (p^28 + 7/2*p^27 + 6*p^26 + 17/2*p^25 + 11*p^24
    + 13*p^23 + 16*p^22 + 39/2*p^21 + 45/2*p^20 + 193/8*p^19 +
    577/24*p^18 + 24*p^17 + 191/8*p^16 + 583/24*p^15 + 24*p^14 +
    23*p^13 + 25*p^12 + 53/2*p^11 + 51/2*p^10 + 73/3*p^9 + 71/3*p^8 +
    121/6*p^7 + 37/2*p^6 + 47/3*p^5 + 41/3*p^4 + 55/6*p^3 + 14/3*p^2 +
    13/6*p + 2/3)/(p^29 + 4*p^28 + 8*p^27 + 12*p^26 + 16*p^25 +
    20*p^24 + 24*p^23 + 28*p^22 + 32*p^21 + 35*p^20 + 36*p^19 +
    36*p^18 + 36*p^17 + 36*p^16 + 36*p^15 + 36*p^14 + 36*p^13 +
    36*p^12 + 36*p^11 + 36*p^10 + 35*p^9 + 32*p^8 + 28*p^7 + 24*p^6 +
    20*p^5 + 16*p^4 + 12*p^3 + 8*p^2 + 4*p + 1),0,0,0,0,0,0 ][i];
    ans2 := [ 1, 1/3, 807/2048, 3569/9198, 
      2622066552451585/6755399441055744, 
      4600088017237/11851521454080 ];
    ans3 := [ 1, 1/4, 50246/177147, 88519/314912, 
      13670659773280445407/48630661836227715204, 
      27339928051320364957/97256382257392300800,
      187753337253607305545121505175940613398920570773363/667895332546333959997341758422844963906033267359584, 
      3695361182765670737008103497388045543478195986819696467/13145515931406847587262809532824796416075654958047897600,0,0,0,0 ];
    ans3 := [ 1, 1/4, 50246/177147, 88519/314912, 
13670659773280445407/48630661836227715204, 
27339928051320364957/97256382257392300800, 
187753337253607305545121505175940613398920570773363/66789533254633395\
9997341758422844963906033267359584, 
3695361182765670737008103497388045543478195986819696467/1314551593140\
6847587262809532824796416075654958047897600, 
293015822835772245417206734021230541922558541973918428346703134280063\
5088255704745791910288914125089/1042345788878786994010730543628778953\
1931598858558331367732701856915411364999429865090515071381206272, 
468579915785610624046304309873689922613888035682192452525740814119527\
8670314157710662887983682873131994449/1666880297607873172993098402512\
067601186729646142720500665471931083942221768262098005904378410953705\
3747200, 597037954159489206979290880206319664518149586876807785186647\
772054831564761936057415447383413964850289571807191552306707819205300\
831091001934399861894787415751526101305571160428763677151/21238443415\
656226574192589807221817534084444526573599194391520402399650779579899\
605158533517023985261119751200768913454773829430393655933621694286462\
73985440832338990333464819033318963200, 
614445875080053742285644193732577639901262571379782772251373557207074\
954746769429291860231369062328438893366197262692797030316096559961196\
622256218627478869873603752836500941069512299750500961/21857695744389\
860266162976228428834648240402183163487182840431686961681672086478495\
851549200293280101900698197633531432962459622368629720832402372602681\
19899828414675732094610361014089236480000 ];
   ans5 := [ 1, 1/6, 70821/390625, 6347171/35156232, 
7881735107302540780681213/43655745685100555419921875, 
56748463622324782409/314321208000179809572, 
4594295664915181847515964291299799399275450088590309341204889987517/25447112945\
942849427538199821863251770537317497655749320983886718750, 
295328525005526435120967653675543452133210145181316140108084273/163578029802596\
1317850647836980602533998971915356816406250000000, 
1481204012907334609063976830226938921994844152104222812172709816005597277129099\
332950907640864578198958026311016300946861429570798278111511276737/820416633180\
1067534627073651394325160676867110627398340432917526150065662591691810798530884\
648087845804204087940547651669476181268692016601562500, 
2982056032940106292633660757244559180712870847172967067264621137300913094925478\
53969125026590429949494574798252987308772738547/1651716002103624083991434022987\
8252933882071303094740591126113163870411678552985010479602578925550915300846099\
85351562500000000 ];
    ans7 := [ 1, 1/8, 767481/5764801, 114333199/860876928, 
      1710545717378249174221103/12879623023252718907350428, 
      1520485044273589324020887/11448553514741025382656000,
      830114274541297592293080584331836820071841798491148872924651/6250378937450715596714432387525627307158694840247124663622096, 
      83373059764873768333548806836138267945984634274177241083967016436677/627760818825988881467701479586456495319035420337439629466650868940800 ];
    ans11 := [ 1, 1/12, 18628061/214358881, 842122289/9701270496, 
      75109175359823491550762525047/865259616638995404226056384486, 
      237945867438456599088299120057/2741142464349825449340608396544,
      6032775888520367004764399023485838243810841499507464827343460110034176693/69497732168876828426485829264835634867483437575969293146574345694846395592, 
      5267303166265453936649317724665335184565703392473267754685956681413168140496267781/60679466876595137856382701075782818757074291523975569945406760636055059546366105600 ];
ans13 := [ 1, 1/14, 60396701/815730721, 25627513939/346413646152, 
47504712059849703293135923857/642133311352880316608797312063, 
74609371599176191952369971082/1008513908738225404836296473575, 
117976031715216926293876523001622837085299903516776925875056702730351488881807/\
1594712116350970658045057160234673882531272000213533003327166270941707944109694\
, 23252450674221828595292362284739494210930577175681091037811026304567604104927\
92383211/3143093074578471796641590552497246778600093128534167294986841565502271\
5983525480675200 ];
ans17 := [ 1, 1/18, 398505841/6975757441, 274234386059/4802808998088, 
50412827913925023541391741610049/882905994089305563977754208631721, 
2749717119882121138622541663072343/48157221636904960581989179518671400, 
1504096757971831367306280889386471201341139300883517247241543616821649511538786\
2695/26342026390010929326008092597151831352693462132679469614007922597248565774\
2378102337, 3386198176491609579440047621933013428085012845778273328408780849281\
806418415581582383408658233/593042443939762720348193780615823153311574477323819\
65665406961222431276632864357412750923484800 ];
ans19 := [ 1, 1/20, 870760501/16983563041, 735010744039/14341675456800, 
906332225439034179346353736275661/17684534180768657011955825953294810, 
139540577649089663670097977062454421/2722743433120456087776196350276960000, 
1141520299231419575204911436927387779821750080211927454515310876878607253408149\
9095071/22273570533168293111706588668544927112466026228683768724201241122817206\
4878210461618040, 4547587127479511673649822152837974256319962106618615831085664\
940892511311340457829262608434972723/887334221807898332400307986034734648357107\
93190440636367326675242438563314527021302382132742400000 ];
  elif eps eq 0 then 
    ans := [ 1, 1/2, (1/2*p^3 + 1/2*p^2 - p + 1)/p^3, (1/2*p^9 +
    3/2*p^8 + p^7 + p^6 + 3/2*p^5 + 3/2*p^4 + 9/8*p^3 + 5/4*p^2 +
    5/4*p + 5/8)/(p^9 + 2*p^8 + 2*p^7 + 2*p^6 + 2*p^5 + 2*p^4 + 2*p^3
    + 2*p^2 + 2*p + 1), (1/2*p^13 + p^12 - 1/2*p^11 + 1/2*p^9 -
    1/3*p^7 + 1/6*p^5 - 5/6*p^3 + 3/2*p^2 + p - 1)/(p^13 + p^12),
    (1/2*p^35 + 5/2*p^34 + 5*p^33 + 7*p^32 + 19/2*p^31 + 25/2*p^30 +
    91/6*p^29 + 35/2*p^28 + 20*p^27 + 133/6*p^26 + 22*p^25 + 22*p^24 +
    49/2*p^23 + 26*p^22 + 103/4*p^21 + 3775/144*p^20 + 473/18*p^19 +
    105/4*p^18 + 3751/144*p^17 + 1907/72*p^16 + 79/3*p^15 + 177/8*p^14
    + 439/24*p^13 + 33/2*p^12 + 1003/72*p^11 + 211/18*p^10 +
    147/16*p^9 + 56/9*p^8 + 271/72*p^7 + 95/48*p^6 + 11/8*p^5 +
    17/24*p^4 - 1/2*p - 1/2)/(p^35 + 4*p^34 + 8*p^33 + 12*p^32 +
    16*p^31 + 20*p^30 + 24*p^29 + 28*p^28 + 32*p^27 + 35*p^26 +
    36*p^25 + 36*p^24 + 36*p^23 + 36*p^22 + 36*p^21 + 36*p^20 +
    36*p^19 + 36*p^18 + 36*p^17 + 36*p^16 + 35*p^15 + 32*p^14 +
    28*p^13 + 24*p^12 + 20*p^11 + 16*p^10 + 12*p^9 + 8*p^8 + 4*p^7 +
    p^6) ,0,0,0,0,0,0][i];
    if i eq 6 then assert ans eq
       (72*p^37 + 216*p^36 + 72*p^35 - 72*p^34 + 72*p^33 
      + 72*p^32 - 48*p^31 - 48*p^30 + 24*p^29 - 48*p^28 - 336*p^27 
      + 24*p^26 + 360*p^25 - 144*p^24 - 252*p^23 + 103*p^22 - 58*p^21 
      - 13*p^20 - 25*p^19 + 92*p^18 - 85*p^17 - 584*p^16 + 54*p^15 
      + 294*p^14 - 112*p^13 + 52*p^12 - 47*p^11 - 62*p^10 + 73*p^9 
      + 97*p^8 + 170*p^7 - 9*p^6 - 6*p^5 + 102*p^4 - 72*p^3 
      + 72*p^2 + 72*p - 72)/(144*p^6*(p + 1)^2*(p^20 - 1)*(p^9 - 1));
    end if;
    ans2 := [ 1, 1/2, 39/64, 7369/12264, 
      247790023169/412316860416, 
      23741333285753/39505071513600 ];
    ans3 := [ 1, 1/2, 431/729, 23131/39364, 
      1493687989147/2541865828329, 
      26377476341107224253/44887561041873369600, 
      12867132501169686770413600142082493903/21896491844123102754263594591174080008, 
      294343764663027931033955778565190344392151909750969/500896049817361971774988932053985536354048733350400,0,0,0,0 ];  
    ans3 := [ 1, 1/2, 431/729, 23131/39364, 1493687989147/2541865828329, 
26377476341107224253/44887561041873369600, 
12867132501169686770413600142082493903/2189649184412310275426359459117\
4080008, 294343764663027931033955778565190344392151909750969/500896049\
817361971774988932053985536354048733350400, 
2021469545947640083290287427483442753285497518596162505390624458725427\
070268935111/344001209453326522916704774629866242786373445893120497932\
8243896142377806233606400, 1872816786110591873372754511492413564766387\
042608257045969310166448482780343764633969241873906017/318704400369543\
2717202672458386331988156537291530920594413262913382222666746910033580\
640228044800, 60578478980880765660751925195981575679461698310897986235\
8567931228369321635176958247674063878220495834033123045832232664593998\
3142893145616480360503175757/10308871621658194484425268914233568637376\
8555852026565528191224205831877334183510074091191554972735086917673796\
98655953224150989099139340007370755236549120, 
2662330464973059017056232916991989606683151964254463538528834375767533\
2488534720210825518801911675218715508443983480914174537716647112461420\
928422573555912183881890878804041833/453058964826419203695511127748190\
0083077223504529448080467699954560055816059370592806551700007254628272\
2842242954381797030037757538227352407621450307386341969329550408744960\
000 ];
ans5 := [ 1, 1/2, 71/125, 6648215/11718744, 4057759286540588/7152557373046875, 
7429975350195262739163119/13096717000007492065500000, 
1081203714449001077747649407411466864997766845456361/19058231555402205259497350\
19821673631668090820312500, 604169346879807082250925145046974335740585991656002\
245118824241938991/106496113152731856630901551886757977473891400739376068115234\
3750000000, 3143196035593890177617688157170492121759037020262161525604459328153\
573276827841140234558903338564922622962761469/554046911510089623266783631205467\
2970112770765607044064745248765119396694434072969670523889362812042236328125000\
, 10398667153884918529269935144126115806012705924662540269913912891156114262718\
2344983610035596496719387032777677061337628959630863342583/18329589867094549937\
7600544099323652053911480192368836460472669165820442100419311639732805607749810\
405948664993047714233398437500000000 ];
    ans7 := [ 1, 1/2, 190/343, 19862977/35869872, 
      21031742633147/37980492079544, 
      1491706993097251566247223058361/2693821744911533790488191488000,
      421370304310187508167532958430997132457/760937968155499999976553447864280200576, 
      324718842942710014061031119942393497847816085755721589154632897654590170041/586398457706068442340676127327555276266242939152241810039880758598276608000 ];
    ans11 := [ 1, 1/2, 716/1331, 380509025/707384307, 
      2451254435208655/4556998002998892, 
      8707149835112389358468768220453946153/16187003617620137076197658505299617280,
      102655019244471446101708945638520060043421711091/190840539021880245669902471961831673595047032672, 
      493849884149143102232961607590238913668474444832310629249293299256405710897960536992389088421/918090306548661959855990794189739094995003400192522342047910565159444196956587741066168921600 ];
ans13 := [ 1, 1/2, 1171/2197, 8792031433/16495887912, 86922419807710/163086595857367, 
1411414081238671900309777602939374487059/26481397821596276952823087638541192632\
00, 29934679479077734461304322173759103737500035528137/561643933190562569610723\
11937205251807517479250044, 529498334638071284882279755826537071946829110831393\
20583590097551729589035304959554953292486073/9934615384535308364632247368299616\
0865847827168936320063514927597189435864587237120451959107200 ];
ans17 := [ 1, 1/2, 2585/4913, 280777246517/533645444232, 
2758917231460301/5243600135067849, 15493744662324619889560687855946279117416733\
/29447422589430189623081114106428048547607200, 
747962661710484425966561236851069689397199450792486/142157838924905974542040911\
8459476162363622283005721, 1188202627140696006527733896099499511460110416218439\
16332608961128873756649196200981332165463270094075309081/2258298793858756041441\
2673317764671529859844673106551975736215735970414240543981819495439861464755835\
5497600 ];
ans19 := [ 1, 1/2, 3592/6859, 20862669877/39837987380, 
23181722567044751/44266298381323220, 977341984232518569618101361766297979451519\
1/18662682106348089979916415488813323830720000, 
69429671176625486884389240880497254399785522066522941/1325783505489283194516384\
54554984010636269839034247200, 300730054885895335743328898210238111202484865567\
19573729829786971688841802400836874112235821227449556806722211/5742544068202875\
5865083482668288263920440055685591032293547028480542664995813954229428540027537\
780160809920000 ];
  end if;
  if p eq 2 and i ge 3 then ans := ans2[i]; end if;
  if p eq 3 and i ge 3 then ans := ans3[i]; end if;
  if p eq 5 and i ge 4 then ans := ans5[i]; end if;
  if p eq 7 and i ge 5 then ans := ans7[i]; end if;
  if p eq 11 and i ge 5 then ans := ans11[i]; end if;
  if p eq 13 and i ge 5 then ans := ans13[i]; end if;
  if p eq 17 and i ge 5 then ans := ans17[i]; end if;
  if p eq 19 and i ge 5 then ans := ans19[i]; end if;
  return ans;
end function;

// The quantities beta_i^eps (where eps = 0, +1, -1) are defined
// in the paper. 

function beta(i,eps,p)
  assert eps in [0,1,-1];
  if unram and eps in [1,-1] then return 1; end if;
if unram and eps eq 0 then return
[
    1,
    1,
    (p^5 - p + 1)/p^5,
    (p^8 + p^7 + p^6 + p^5 + p^4 + p^2 + p + 1)/(p^8 + p^7 + p^6 + p^5 + p^4 + 
        p^3 + p^2 + p + 1),
    (p^16 - p^10 + p^9 - p^3 + 2*p - 1)/p^16,
    (p^19 + p^18 + p^17 + p^16 + p^15 + p^14 + p^13 + 3*p^10 + p^8 + p^7 + p^6 +
        2*p^3 + p^2 + p + 1)/(p^19 + p^18 + p^17 + p^16 + p^15 + p^14 + p^13 + 
        p^12 + p^11 + p^10 + p^9 + p^8 + p^7 + p^6 + p^5 + p^4 + p^3 + p^2 + p +
        1)
][i];
end if;
  if eps eq 1 then
    ans := 1;
    if [i,p] eq [6,13] then 
      ans := 371285/371293;
    end if;
    ans2 := [ 1, 1, 7/8, 13863/16384, 112890027/134217728, 
      181758474868208129/216172782113783808 ];
    ans3 := [ 1, 1, 26/27, 76/81, 160260073/172186884, 
      28366779023771/30502389939948,
      7786025861249172415064604943/8373136707408025275363579744, 
      1379267616735270429691300281942109/1483276048307209453454832060910368,
0,0,0,0 ];
    ans3 := [ 1, 1, 26/27, 76/81, 160260073/172186884, 
28366779023771/30502389939948, 7786025861249172415064604943/837313670\
7408025275363579744, 1379267616735270429691300281942109/1483276048307\
209453454832060910368, 2131185773982867796667844604201574189620623848\
0128218858468149351/2291895434987636921875748343474257514649426862689\
6364187848198400, 858029922463218762987832940463382039386245526886867\
34565399602789113/922732728685806631362552708639623399880913682829275\
05154198745499200, 21980047240617163869489159373508568061693180090584\
667274077140037005647226958565803587292297372361350695732594711367115\
8399053151/2363753108890643980865537333132467594886542062976575439588\
794986916880979773918363558540055670893591775606027814560085640612966\
40, 19468497142666187453758007918243346641520333716423310383177918898\
471674906038407335587561528578098028894255591455646363644172611506745\
3/2093658859903254546391936709762086185156831334150557046984181327736\
82357462005158174652347620965893551136640504632937745488832579430400 ];
    ans5 := [ 1, 1, 1, 124/125, 240695821/244140625, 7215652829/7324218750, 
223931502471811572669029758321/227373675443232059478759765625, 
39362017539577928772814402758542947763/39968008422874845564365386962890625000, 
2731279081318279098692166942253121770392755208534404892245098081540283079743/27\
73337699967990230579358496210877829679652961658575804904103279113769531250, 
4883907160578965449145311278147775072116843217751799761800019815778814725446711\
31347841323/4959114253463675648020215654118605190275027275355335110162968703662\
04530000686645507812500 ];
    ans7 := [ 1, 1, 1, 1, 16759/16807, 96575128400/96889010407,
      18923976801445/18990246039772, 
      21139290378603757063836061272597/21213846766877227774232187052808 ];
    ans11 := [ 1, 1, 1, 1, 14640/14641, 161031/161051,4556128999010231/4556998002998892, 12529264136479078/12531744508246953 ];
ans13 := [ 1, 1, 1, 1, 1, 371285/371293, 3937208463612349/3937376385699289, 
358284670537386267/358301251098635299 ];
ans17 := [ 1, 1, 1, 1, 1, 1, 24137521/24137569, 6975741663/6975757441 ];
ans19 := [ 1, 1, 1, 1, 1, 1, 47045872/47045881, 16983554608/16983563041 ];
  elif eps eq -1 then 
    ans := [ 1, p/(p + 1), 1, (p^10 + 3*p^9 + 3*p^8 + 2*p^7 + 3/2*p^6
    + 5/2*p^5 + 5/2*p^4 + 5/2*p^3 + 5/2*p^2 + p)/(p^10 + 3*p^9 + 4*p^8
    + 4*p^7 + 4*p^6 + 4*p^5 + 4*p^4 + 4*p^3 + 4*p^2 + 3*p + 1), 1,
    (p^31 + 4*p^30 + 8*p^29 + 11*p^28 + 13*p^27 + 29/2*p^26 +
    103/6*p^25 + 56/3*p^24 + 133/6*p^23 + 68/3*p^22 + 68/3*p^21 +
    127/6*p^20 + 62/3*p^19 + 65/3*p^18 + 139/6*p^17 + 193/8*p^16 +
    577/24*p^15 + 24*p^14 + 191/8*p^13 + 583/24*p^12 + 23*p^11 +
    19*p^10 + 17*p^9 + 31/2*p^8 + 25/2*p^7 + 59/6*p^6 + 15/2*p^5 +
    5*p^4 + 7/3*p^3 + 3/2*p^2 + 2*p + 1)/(p^31 + 4*p^30 + 8*p^29 +
    12*p^28 + 16*p^27 + 20*p^26 + 24*p^25 + 28*p^24 + 32*p^23 +
    35*p^22 + 36*p^21 + 36*p^20 + 36*p^19 + 36*p^18 + 36*p^17 +
    36*p^16 + 36*p^15 + 36*p^14 + 36*p^13 + 36*p^12 + 35*p^11 +
    32*p^10 + 28*p^9 + 24*p^8 + 20*p^7 + 16*p^6 + 12*p^5 + 8*p^4 +
    4*p^3 + p^2),0,0,0,0,0,0 ][i];
    ans2 := [ 1, 2/3, 7/8, 3832/4599, 
      112890027/134217728, 77846654407/92590011360 ];
    ans3 := [ 1, 3/4, 26/27, 288303/314912, 160260073/172186884, 
      9541669997405587/10262359634630400, 
      7786025861249172415064604943/8373136707408025275363579744, 
      851893435532877856280779557089568924278321176897/916133607347712797027871846463622380162869196800,0,0,0,0  ];
    ans3 := [ 1, 3/4, 26/27, 288303/314912, 160260073/172186884, 
9541669997405587/10262359634630400, 7786025861249172415064604943/837313670\
7408025275363579744, 851893435532877856280779557089568924278321176897/9161\
33607347712797027871846463622380162869196800, 
21311857739828677966678446042015741896206238480128218858468149351/22918954\
349876369218757483434742575146494268626896364187848198400, 
27101653029702230289429609635983039678562664333627596467511709904966484998\
178639106396686075/2914534982803322100779764479548543199045758839991696931\
3335737662388867551412071637683038208, 
21980047240617163869489159373508568061693180090584667274077140037005647226\
9585658035872922973723613506957325947113671158399053151/236375310889064398\
08655373331324675948865420629765754395887949869168809797739183635585400556\
7089359177560602781456008564061296640, 
43780405250824038189134347758618317050399500273819858638485569655431565114\
77415341478796328935329221831339369756239594683437093259945288365625561161\
53837393349960383023471/47081822840173255569637852573906763967631287198418\
83942789728514112374585421468380104077503436894280534027751065633890035128\
83542609504015542476725146385064319424184320000 ];
    ans5 := [ 1, 5/6, 1, 33972635/35156232, 240695821/244140625, 
7734711366000981238927/7858030200004495239300, 
223931502471811572669029758321/227373675443232059478759765625, 
5034265721379128835552191578457270193172044359173319564644653186437/511181343133112911\
8283274490564382918746787235490051269531250000000, 
2731279081318279098692166942253121770392755208534404892245098081540283079743/277333769\
9967990230579358496210877829679652961658575804904103279113769531250, 
28882581709251181748961840781269788750089674126813855553698945727549888454983796349656\
6564520189433994932234273145851612181732180777/293273437873512799004160870558917843286\
25836830779013833675627066531270736067089862357248897239969664951786398887634277343750\
0000000 ];
    ans7 := [ 1, 7/8, 1, 845406079/860876928, 16759/16807, 
      558604480414265382571976609/560979122222310243750144000, 
      18923976801445/18990246039772, 
      52567148382555204986010698267322722176784623016732410440331835617279723423/52753880410041975654138293837047871584135141548056739262230005771440128000 ];
    ans11 := [ 1, 11/12, 1, 9627548249/9701270496, 14640/14641, 
      331438816317533251615697367541747/331678238186328879370213615981824,
      4556128999010231/4556998002998892, 
      15353285533355426591541404353652537666725628849421251367705244202481112581445495540876403/15356768145623965573713027757216412311443041280929383524007820897024333906431412057548800 ];
ans13 := [ 1, 13/14, 1, 344505849883/346413646152, 1, 
340733298177552891039806792060137/340877701153520186834668208068350, 
3937208463612349/3937376385699289, 1972109021717890796368218440418310013953934415892939411669303961554931508871520826150605982679/1972244292227695053655853876904128819401831798774093815903258427492259029278420344080958678400 ];
ans17 := [ 1, 17/18, 1, 4787090914859/4802808998088, 1, 
264380399119143980869519633554950561909/264431304008245138555702584737024657400\
, 24137521/24137569, 2433451308745648174671269749440047727564192717166681278685\
9117021900675788864674192938161669110510032937/24334824947891912660254793388474\
999553254702656572474920274654472974907887225468609745927222277367670400 ];
ans19 := [ 1, 19/20, 1, 14303889773359/14341675456800, 1, 
982774083996509467435184335213800546319/982910379356484647687206882449982560000\
, 47045872/47045881, 7931569557080686518005291525626078496970618566278244705796\
4353124320131645509825458219227213328423775343017/79316298392163780631786334361\
245597453052156010208529805928937980046805190617872494050361836977927033600000 ];
  elif eps eq 0 then 
    ans := [ 1, 1/2, (2/3*p^5 - 1/6*p^3 + 1/2*p^2 - p + 1)/p^5,
    (5/8*p^9 + 5/4*p^8 + 5/4*p^7 + 9/8*p^6 + 3/2*p^5 + p^4 + p^3 +
    3/2*p^2 + 3/2*p + 1/2)/(p^9 + 2*p^8 + 2*p^7 + 2*p^6 + 2*p^5 +
    2*p^4 + 2*p^3 + 2*p^2 + 2*p + 1), (19/30*p^17 + 19/30*p^16 -
    1/12*p^15 + 1/6*p^14 - 3/10*p^13 + 1/5*p^12 + 1/4*p^11 - 1/3*p^7 +
    1/6*p^5 - 5/6*p^3 + 3/2*p^2 + p - 1)/(p^17 + p^16), (91/144*p^29 +
    91/36*p^28 + 5*p^27 + 1075/144*p^26 + 719/72*p^25 + 37/3*p^24 +
    117/8*p^23 + 427/24*p^22 + 21*p^21 + 1651/72*p^20 + 218/9*p^19 +
    1169/48*p^18 + 427/18*p^17 + 1711/72*p^16 + 1159/48*p^15 +
    187/8*p^14 + 545/24*p^13 + 49/2*p^12 + 26*p^11 + 101/4*p^10 +
    301/12*p^9 + 95/4*p^8 + 85/4*p^7 + 223/12*p^6 + 33/2*p^5 +
    29/2*p^4 + 10*p^3 + 11/2*p^2 + 5/2*p + 1/2)/(p^29 + 4*p^28 +
    8*p^27 + 12*p^26 + 16*p^25 + 20*p^24 + 24*p^23 + 28*p^22 + 32*p^21
    + 35*p^20 + 36*p^19 + 36*p^18 + 36*p^17 + 36*p^16 + 36*p^15 +
    36*p^14 + 36*p^13 + 36*p^12 + 36*p^11 + 36*p^10 + 35*p^9 + 32*p^8
    + 28*p^7 + 24*p^6 + 20*p^5 + 16*p^4 + 12*p^3 + 8*p^2 + 4*p + 1),
       0,0,0,0,0,0][i];
    ans2 := [ 1, 1/2, 167/256, 1907/3066, 4129366716929/6597069766656, 
      6178754224801/9876267878400 ];
    ans3 := [ 1, 1/2, 4319/6561, 6137/9841, 129514464056263/205891132094649, 
      690037935950003/1098030248972800, 
      10032156684494048156949939738504415213891/15962542554365741907858160456965904325832, 
      1777068734818155098116246297731080085713434213/2827572862184298756258863723653155494329843200,0,0,0,0 ];
    ans3 := [ 1, 1/2, 4319/6561, 6137/9841, 129514464056263/205891132094649, 
690037935950003/1098030248972800, 1003215668449404815694993973850441521389\
1/15962542554365741907858160456965904325832, 
1777068734818155098116246297731080085713434213/282757286218429875625886372\
3653155494329843200, 56738844001643552563230163945840694355528491506953212\
6445518267115178892098803658013/902796774089310126742600010538620967568558\
471401905434774904328103605631467947663616, 
46530580175045568977891461504974735674832040918478050714086764831789534320\
109646124705873/7403685878177417316414582328782561598957879489894063230537\
9610990166304809764953608908800, 31358431452481686740041720628107153381481\
18479436155925061587887507791180967212409323403413759647833411612196801001\
1436252163483189895150021436701048569271883/498957836383028464025268609931\
62130694136552905789480884214455722378414136936082675123039099422828148749\
194426543109457535482930763531056401248829996966310400, 
80764634945833736321759333355759683563246251197798634991472616606301918563\
55004962397439232480018034503347519263004918690375094531847330499801531273\
85986826378794443/12850817353512410069963410367213481512099727175924166877\
90540225088684227165063253325771538415158332485010871934867845594092922012\
606664018085245519161303909335040000 ];
    ans5 := [ 1, 1/2, 2071/3125, 7318807/11718744, 2822279805184978088/4470348358154296875, 
528387353240735795971/838189888000479492192, 
18775163475572346420252413823920233647851402185790768861/29778486805315945717964609684\
713650494813919067382812500, 137511378306927773105579331558661868147044917882188239322\
07979/21810403973679484238008637826408033786652958871424218750000000, 
71091822130795824434549213858350535065771533605348431647921887807316974893559080982290\
4368720544699509807825601684662849/112757203475295583485154012444550180368310686284424\
6077239169768213752217890684381718102713421103544533252716064453125000, 
10413835255404000329654182893637486782151312620340555534395756322022566490875766904594\
05925802900099786500118450703664581332297/16517160021036240839914340229878252933882071\
30309474059112611316387041167855298501047960257892555091530084609985351562500000000 ];
    ans7 := [ 1, 1/2, 11166/16807, 22411219/35869872, 
      57648621987359803/91191161482985144, 
      14449703465164905975918127/22897107029482050765312000,
      18835931539730288567314802197017421930097331/29841197005175473165747178862594900439188608, 
      37437418687899732084409410210772347662860417909532261812395332237/59312246676680733320833473127972080056598206759017349722850611200 ];
    ans11 := [ 1, 1/2, 107196/161051, 1768275625/2829537228, 
      42219740690554362319/66719007761906777772, 
      5770621609505252498793147815123/9137141547832751497802027988480,
      213575801919501539878444857960869109591223367384011483/338085656150141189899218093131174481505715116247440992, 
      2032724054885151297817843881148382783837405417616086753458123279053762862639858841/3217850516183075492383931117655149479541818489907795375892782761002919824428505600 ];
    ans13 := [ 1, 1/2, 247235/371293, 10309239049/16495887912, 
2948166125754129858/4657916264282258887, 
346548367443252206433568213879007/548631566353594620230945281624800, 
171286282349809209551010934479571139459315938448013410765/271094799151960612606016484909309744271791636501425629596, 35023690868319931079468309746657866577061659187328413004285033629992543287262796581/55433740292389273309375494753037862056439032249279846472431068174643238066182505600 ];
ans17 := [ 1, 1/2, 945881/1419857, 333517665589/533645444232, 
277262134409139077021/437950726881001816329, 
40565858478396208116585907348237279/64209628849206614109318906024895200, 
21684505858967352237314474743195752877851045230744765885698/3431344645940803779\
0207559105044779572907135945988118032249, 
4164027954252419334217226075680260558225256688175205418482899789738611038571820\
484378033294633/658936048821958578164659756239803503679527197026466285171188458\
0270141848096039712527880387200 ];
ans19 := [ 1, 1/2, 1649752/2476099, 12449076839/19918993690, 
3652447168275221349071/5768828271352423353620, 
250631403401535036451332325843652389/396691096216225390272028607325120000, 
3941884693848207356290841236737731361199040108467265471510661/62372653031011663\
94451767988017685721296685131094348695783200, 
3115367156794699441770566853643286179914486669938198692600700179370720526295640\
45386759915329751/4929634565599435180001711033526303601983932955024479798184815\
29124658685080705673902122959680000 ];
  end if;
  if p eq 2 and i ge 3 then ans := ans2[i]; end if;
  if p eq 3 and i ge 3 then ans := ans3[i]; end if;
  if p eq 5 and i ge 4 then ans := ans5[i]; end if;
  if p eq 7 and i ge 5 then ans := ans7[i]; end if;
  if p eq 11 and i ge 5 then ans := ans11[i]; end if;
  if p eq 13 and i ge 5 then ans := ans13[i]; end if;
  if p eq 17 and i ge 5 then ans := ans17[i]; end if;
  if p eq 19 and i ge 5 then ans := ans19[i]; end if;
  return ans;
end function;
